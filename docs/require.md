# 要件整理

## 1. 背景とスコープ
CodeSpark はローカルに保存したコードスニペットを高速検索・コピーできるランチャーであり、キーボード中心の操作体験を最優先とする。ドキュメントでは実装技術に依存しないドメイン要件を定義し、将来的な Git 連携やチーム共有を見据える。

## 2. エンティティ要件
- **Snippet**: `id`, `title`, `body` は必須。`tags` は重複禁止、`language` や `description` は任意。`isFavorite`, `usageCount`, `lastUsedAt` を保持して利用頻度を追跡し、`shortcut` で個別キーワード検索を実現する。`updatedAt >= createdAt` を満たすこと。
- **Tag**: 文字列として取り扱い、必要に応じて `id`, `color`, `kind` を持つ独立エンティティへ昇格可能。
- **LibraryCategory**: `"PERSONAL" | "TEAM" | "PROJECT"` を想定し、利用コンテキストのみで分類する（保存場所は区別しない）。MVP の UI スコープは `PERSONAL` と `TEAM` の 2 種類に限定する。
- **SnippetLibrary**: `id`, `name`, `description`, `isReadOnly`, `category` を持つ論理コンテナ。Snippet は `libraryId` を保持し、カテゴリに応じたスコープ切替を可能にする。
- **UserPreferences（拡張枠）**: デフォルトライブラリやテーマ、グローバルショートカットを格納し、体験を個別最適化する。

## 3. ユースケース要件
1. **UC-01 検索してコピー**: キーワード入力→スコアリング→ハイライト→コピー→`usageCount` 更新。コピー時はほぼ1アクションで完結させる。
2. **UC-02 新規登録**: 入力値を検証して `SnippetDataAccessAdapter.save`。タイトル/本文必須、タグ重複排除。
3. **UC-03 編集**: `getById` 取得→差分マージ→`updatedAt` 更新→保存。
4. **UC-04 削除**: `delete` 実行後にキャッシュ・UI を同期。
5. **UC-05 絞り込み**: タグ、ライブラリ、キーワード条件で集合をフィルタ。検索ロジックと統合可能。
6. **UC-06 最近使った表示**: `usageCount`・`lastUsedAt` を使い上位 N 件を返す。
7. **UC-07 ライブラリ切り替え/管理**: 取得・追加・切替のフックを用意し、Personal/Team 切替 UI に繋げる。
8. **補助 UC**: `CopySnippetUseCase` で使用履歴を更新、`GetTopSnippetsForEmptyQueryUseCase` で空クエリ時候補を返す。

## 4. ライブラリ運用に関する要件
- `Personal` は雑多なメモや検証用スペース、`Team` は共有可能な高品質スニペットの保管場所として切り分ける。
- ライブラリ切替 UI で `All/Personal/Team` を素早く変更できる（ショートカット `⌘1`〜`⌘3` 等）。
- `Team` ライブラリはオンボーディングパックとして配布可能で、新人は Team 範囲のみ検索してキャッチアップする。
- MVP 実装は `Personal` / `Team` の 2 つのライブラリスコープのみを提供し、その他のカテゴリは設定 UI が整い次第徐々に解放する（データモデル上は先に用意しておく）。

## 5. Raycast ライクな体験要件
- `SearchSnippetsUseCase` で shortcut 完全一致、タイトル前方一致、タグ/本文一致の順にスコアを付け、`isFavorite` と使用履歴にボーナスを与える。
- アプリ起動時に検索バーへフォーカスし、空クエリではお気に入り＋最近利用を提示する。
- `Enter` キーでトップ候補をコピーでき、`↓/↑` で選択移動、`⌘Enter` など追加アクションの余地を残す。

## 6. システム前提と検討事項
- macOS と Windows の両 OS に対して同一機能を提供することを最優先とし、Linux は可能な範囲でサポートする。
- 当面は単一ユーザー、保存先はローカルファイルまたはローカル DB を想定。
- クリップボードコピー以外の高度な操作（エディタ貼り付け、コマンド実行）は今後検討。
- プレースホルダ付きテンプレ、ショートカット割り当て、共有範囲、ライブラリの ReadOnly ルールなどは将来の拡張候補として記録し、必要時にドメインへ編入する。
